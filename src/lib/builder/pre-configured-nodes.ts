/**
 * Biblioteca de N√≥s Pr√©-Configurados para RH
 * N√≥s prontos para arrastar e usar, sem necessidade de configura√ß√£o t√©cnica
 */

export interface PreConfiguredNode {
  id: string;
  category: 'rh' | 'financeiro' | 'juridico' | 'geral';
  name: string;
  description: string;
  icon: string;
  nodeType: 'input' | 'ai' | 'logic' | 'api' | 'output';
  config: {
    label: string;
    prompt?: string;
    inputSchema?: any;
    condition?: string;
    apiEndpoint?: string;
  };
}

export const preConfiguredNodes: PreConfiguredNode[] = [
  // ===== CATEGORIA: RH =====
  {
    id: 'rh-upload-curriculo',
    category: 'rh',
    name: 'Receber Curr√≠culo',
    description: 'Permite o upload de curr√≠culos em PDF ou Word',
    icon: 'üìÑ',
    nodeType: 'input',
    config: {
      label: 'Upload de Curr√≠culo',
      inputSchema: {
        type: 'object',
        properties: {
          curriculo: {
            type: 'string',
            format: 'binary',
            description: 'Arquivo do curr√≠culo (PDF ou DOCX)'
          },
          nome_candidato: {
            type: 'string',
            description: 'Nome do candidato (opcional)'
          },
          vaga: {
            type: 'string',
            description: 'Vaga pretendida (opcional)'
          }
        }
      }
    }
  },
  
  {
    id: 'rh-analisar-curriculo',
    category: 'rh',
    name: 'Analisar Curr√≠culo',
    description: 'Extrai informa√ß√µes do curr√≠culo: nome, experi√™ncia, forma√ß√£o, habilidades',
    icon: 'üîç',
    nodeType: 'ai',
    config: {
      label: 'An√°lise de Curr√≠culo',
      prompt: `Voc√™ √© um especialista em Recursos Humanos. Analise o curr√≠culo fornecido e extraia as seguintes informa√ß√µes:

1. **Dados Pessoais:**
   - Nome completo
   - Email
   - Telefone
   - LinkedIn (se houver)

2. **Forma√ß√£o Acad√™mica:**
   - Cursos (gradua√ß√£o, p√≥s, MBA, etc.)
   - Institui√ß√µes
   - Anos de conclus√£o

3. **Experi√™ncia Profissional:**
   - Empresas onde trabalhou
   - Cargos ocupados
   - Per√≠odo de cada experi√™ncia
   - Principais responsabilidades

4. **Habilidades e Compet√™ncias:**
   - Habilidades t√©cnicas (hard skills)
   - Habilidades comportamentais (soft skills)
   - Idiomas
   - Certifica√ß√µes

5. **Resumo Profissional:**
   - Breve resumo da trajet√≥ria
   - Pontos fortes
   - √Åreas de especializa√ß√£o

Retorne as informa√ß√µes de forma estruturada e objetiva.`
    }
  },

  {
    id: 'rh-pontuar-candidato',
    category: 'rh',
    name: 'Pontuar Candidato',
    description: 'Avalia e d√° uma nota de 0 a 100 para o candidato',
    icon: '‚≠ê',
    nodeType: 'ai',
    config: {
      label: 'Pontua√ß√£o do Candidato',
      prompt: `Voc√™ √© um especialista em recrutamento e sele√ß√£o. Com base nas informa√ß√µes do curr√≠culo, avalie o candidato e atribua uma pontua√ß√£o de 0 a 100, considerando:

**Crit√©rios de Avalia√ß√£o (peso de cada um):**

1. **Experi√™ncia Relevante (30 pontos)**
   - Anos de experi√™ncia na √°rea
   - Empresas de renome no curr√≠culo
   - Progress√£o de carreira

2. **Forma√ß√£o Acad√™mica (25 pontos)**
   - N√≠vel de escolaridade
   - Qualidade das institui√ß√µes
   - Cursos complementares

3. **Habilidades T√©cnicas (25 pontos)**
   - Dom√≠nio de ferramentas/tecnologias relevantes
   - Certifica√ß√µes
   - Conhecimentos espec√≠ficos

4. **Habilidades Comportamentais (10 pontos)**
   - Lideran√ßa
   - Trabalho em equipe
   - Comunica√ß√£o

5. **Adequa√ß√£o Cultural (10 pontos)**
   - Valores alinhados
   - Experi√™ncias em ambientes similares

**Retorne:**
- Pontua√ß√£o total (0-100)
- Pontua√ß√£o de cada crit√©rio
- Justificativa da nota
- Recomenda√ß√£o (Aprovado/Em An√°lise/Reprovado)`
    }
  },

  {
    id: 'rh-verificar-aprovacao',
    category: 'rh',
    name: 'Verificar se Aprovado',
    description: 'Decide se o candidato foi aprovado (nota >= 70)',
    icon: '‚úÖ',
    nodeType: 'logic',
    config: {
      label: 'Candidato Aprovado?',
      condition: 'output.pontuacao >= 70'
    }
  },

  {
    id: 'rh-upload-contrato',
    category: 'rh',
    name: 'Receber Contrato',
    description: 'Permite o upload de contratos de trabalho',
    icon: 'üìã',
    nodeType: 'input',
    config: {
      label: 'Upload de Contrato',
      inputSchema: {
        type: 'object',
        properties: {
          contrato: {
            type: 'string',
            format: 'binary',
            description: 'Arquivo do contrato (PDF ou DOCX)'
          },
          tipo_contrato: {
            type: 'string',
            enum: ['CLT', 'PJ', 'Est√°gio', 'Tempor√°rio'],
            description: 'Tipo de contrato'
          }
        }
      }
    }
  },

  {
    id: 'rh-analisar-contrato',
    category: 'rh',
    name: 'Analisar Contrato',
    description: 'Verifica cl√°usulas, valores e conformidade legal do contrato',
    icon: '‚öñÔ∏è',
    nodeType: 'ai',
    config: {
      label: 'An√°lise de Contrato',
      prompt: `Voc√™ √© um especialista em Direito do Trabalho. Analise o contrato fornecido e verifique:

1. **Informa√ß√µes B√°sicas:**
   - Tipo de contrato (CLT, PJ, etc.)
   - Partes envolvidas (empregador e empregado)
   - Data de in√≠cio
   - Dura√ß√£o (determinado ou indeterminado)

2. **Remunera√ß√£o:**
   - Sal√°rio base
   - Benef√≠cios (VT, VR, plano de sa√∫de, etc.)
   - B√¥nus ou comiss√µes
   - Forma de pagamento

3. **Jornada de Trabalho:**
   - Horas semanais
   - Hor√°rio de trabalho
   - Horas extras
   - Banco de horas

4. **Cl√°usulas Importantes:**
   - Per√≠odo de experi√™ncia
   - Aviso pr√©vio
   - Confidencialidade
   - N√£o-competi√ß√£o
   - Rescis√£o

5. **Conformidade Legal:**
   - Est√° de acordo com a CLT?
   - H√° cl√°usulas abusivas?
   - Faltam informa√ß√µes obrigat√≥rias?
   - Riscos legais identificados

6. **Recomenda√ß√µes:**
   - Pontos que precisam ser ajustados
   - Sugest√µes de melhorias
   - Alertas importantes

Retorne uma an√°lise completa e objetiva.`
    }
  },

  {
    id: 'rh-verificar-conformidade',
    category: 'rh',
    name: 'Verificar Conformidade',
    description: 'Verifica se o contrato est√° em conformidade com a CLT',
    icon: '‚úîÔ∏è',
    nodeType: 'logic',
    config: {
      label: 'Contrato Conforme?',
      condition: 'output.conforme_clt === true && output.clausulas_abusivas === 0'
    }
  },

  {
    id: 'rh-upload-folha-pagamento',
    category: 'rh',
    name: 'Receber Folha de Pagamento',
    description: 'Permite o upload de planilhas de folha de pagamento',
    icon: 'üí∞',
    nodeType: 'input',
    config: {
      label: 'Upload de Folha',
      inputSchema: {
        type: 'object',
        properties: {
          folha: {
            type: 'string',
            format: 'binary',
            description: 'Planilha da folha de pagamento (Excel ou PDF)'
          },
          mes_referencia: {
            type: 'string',
            description: 'M√™s de refer√™ncia (ex: Janeiro/2025)'
          }
        }
      }
    }
  },

  {
    id: 'rh-analisar-folha',
    category: 'rh',
    name: 'Analisar Folha de Pagamento',
    description: 'Verifica valores, descontos e conformidade da folha',
    icon: 'üìä',
    nodeType: 'ai',
    config: {
      label: 'An√°lise de Folha',
      prompt: `Voc√™ √© um especialista em Departamento Pessoal. Analise a folha de pagamento e verifique:

1. **Resumo Geral:**
   - Total de funcion√°rios
   - Total de proventos
   - Total de descontos
   - Valor l√≠quido total

2. **Proventos:**
   - Sal√°rios
   - Horas extras
   - Comiss√µes
   - B√¥nus
   - Outros

3. **Descontos:**
   - INSS
   - IRRF
   - Vale transporte
   - Vale refei√ß√£o
   - Plano de sa√∫de
   - Outros

4. **Verifica√ß√µes:**
   - C√°lculos est√£o corretos?
   - Descontos dentro dos limites legais?
   - H√° inconsist√™ncias?
   - Valores divergentes do esperado?

5. **Alertas:**
   - Funcion√°rios com desconto acima de 30%
   - Valores zerados ou negativos
   - Poss√≠veis erros de c√°lculo

Retorne uma an√°lise detalhada e aponte qualquer irregularidade.`
    }
  },

  {
    id: 'rh-gerar-relatorio',
    category: 'rh',
    name: 'Gerar Relat√≥rio',
    description: 'Cria um relat√≥rio profissional com os resultados',
    icon: 'üìÑ',
    nodeType: 'output',
    config: {
      label: 'Relat√≥rio Final'
    }
  },

  // ===== CATEGORIA: GERAL =====
  {
    id: 'geral-enviar-email',
    category: 'geral',
    name: 'Enviar Email',
    description: 'Envia o relat√≥rio por email automaticamente',
    icon: 'üìß',
    nodeType: 'api',
    config: {
      label: 'Enviar por Email',
      apiEndpoint: '/api/send-report-email',
    }
  },

  {
    id: 'geral-salvar-arquivo',
    category: 'geral',
    name: 'Salvar Arquivo',
    description: 'Salva o resultado em PDF ou Excel',
    icon: 'üíæ',
    nodeType: 'output',
    config: {
      label: 'Salvar Resultado'
    }
  },

  {
    id: 'geral-notificar-equipe',
    category: 'geral',
    name: 'Notificar Equipe',
    description: 'Envia notifica√ß√£o para a equipe de RH',
    icon: 'üîî',
    nodeType: 'api',
    config: {
      label: 'Notificar Equipe',
      apiEndpoint: '/api/notifications/team'
    }
  }
];

/**
 * Categorias organizadas para exibi√ß√£o
 */
export const nodeCategories = {
  rh: {
    name: 'Recursos Humanos',
    icon: 'üë•',
    description: 'Processos de RH: curr√≠culos, contratos, folha de pagamento',
    nodes: preConfiguredNodes.filter(n => n.category === 'rh')
  },
  financeiro: {
    name: 'Financeiro',
    icon: 'üí∞',
    description: 'Processos financeiros: despesas, reembolsos, or√ßamentos',
    nodes: preConfiguredNodes.filter(n => n.category === 'financeiro')
  },
  juridico: {
    name: 'Jur√≠dico',
    icon: '‚öñÔ∏è',
    description: 'Processos jur√≠dicos: contratos, conformidade, an√°lises legais',
    nodes: preConfiguredNodes.filter(n => n.category === 'juridico')
  },
  geral: {
    name: 'A√ß√µes Gerais',
    icon: '‚öôÔ∏è',
    description: 'A√ß√µes comuns: enviar email, salvar arquivo, notificar',
    nodes: preConfiguredNodes.filter(n => n.category === 'geral')
  }
};

/**
 * Buscar n√≥ pr√©-configurado por ID
 */
export function getPreConfiguredNode(id: string): PreConfiguredNode | undefined {
  return preConfiguredNodes.find(n => n.id === id);
}

/**
 * Buscar n√≥s por categoria
 */
export function getNodesByCategory(category: string): PreConfiguredNode[] {
  return preConfiguredNodes.filter(n => n.category === category);
}

/**
 * Buscar n√≥s por termo de busca
 */
export function searchNodes(query: string): PreConfiguredNode[] {
  const lowerQuery = query.toLowerCase();
  return preConfiguredNodes.filter(n => 
    n.name.toLowerCase().includes(lowerQuery) ||
    n.description.toLowerCase().includes(lowerQuery)
  );
}
